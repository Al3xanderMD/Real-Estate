@page "/"
@using GlobalBuyTicket.App.Auth
@using Microsoft.AspNetCore.Components.Authorization
@using RealEstate.App.Auth
@using RealEstate.App.Data
@using RealEstate.App.Models
@using RealEstate.App.Services
@using RealEstate.App.Tools

@inject NavigationManager navigationManager
@inject HttpClient Http
@inject Blazored.SessionStorage.ISessionStorageService session 
@inject Blazored.LocalStorage.ILocalStorageService localStorage
@inject CustomStateProvider authStateProvider
@inject IJSRuntime JSRuntime
@inject ISessionStorageService sessionStorage

<head>
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
	<link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />

	<link rel="stylesheet" href="css/styles.css?v=@MyTools.ver" />
</head>
<DataLoader />

<PageTitle>Home</PageTitle>

<div class="main-div">
	<div class="main-left">
		<h2 class="main-text">
			<span>Find your new </span>
			<strong>Home</strong>
		</h2>
        <button class="explore-button" @onclick="NavigateToBrowsePage">Explore</button>
	</div>
	<img src="images/mainpic.svg" alt="Main Picture" class="main-img"/>
	<div class="color-overlay"></div>
</div>


<PageTitle>Home</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudText Class="featured-title" Typo="Typo.h4">Featured Properties</MudText>

    
    <MudGrid Justify="Justify.SpaceEvenly">
        <div class="row">
            @for (int i = propertyIndex; i < propertyIndex + 4 && i < GetHardcodedProperties().Count; i++)
            {
                var property = GetHardcodedProperties()[i];
                <MudItem xs="12" sm="6" md="4" lg="3">
                    <MudCard Class="browse-card" Elevation="1">
                        <MudCardMedia Image="@property.MainImageUrl" />
                        <MudCardContent>
                            <MudText Typo="Typo.h5">@property.Title</MudText>
                                <MudText Typo="Typo.body2"><MudIcon Icon="@Icons.Material.Filled.Euro" />@property.Price</MudText>
                            </MudCardContent>
                            <MudCardActions>
                                <MudIconButton Icon="@Icons.Material.Filled.Favorite" Color="Color.Default" />
                                <MudIconButton Icon="@Icons.Material.Filled.Share" Color="Color.Default" />
                            </MudCardActions>
                        </MudCard>
                    </MudItem>
            }
        </div>
    </MudGrid>

    <MudContainer Class="d-flex justify-content-end align-items-end">
        <MudButton OnClick="() => propertyIndex = (propertyIndex - 4 + GetHardcodedProperties().Count) % GetHardcodedProperties().Count"><MudIcon Icon="@Icons.Material.Filled.ArrowBackIos" /></MudButton>
            <MudButton OnClick="() => propertyIndex = (propertyIndex + 4) % GetHardcodedProperties().Count"><MudIcon Icon="@Icons.Material.Filled.ArrowForwardIos" /></MudButton>
    </MudContainer>

</MudContainer>

@if (isAuth)
{
	<h3>Welcome, @authenticationState.User.Identity.Name</h3>
}
else
{
	<h3>Welcome, guest</h3>
}

@code {
    protected override async Task OnInitializedAsync()
    {
        BrowsePageFunctions functions = new BrowsePageFunctions();

        await functions.deleteBrowseData(sessionStorage);
    }

    private async void NavigateToBrowsePage()
    {
        navigationManager.NavigateTo("/browse");
    }
	private List<PostModel> GetHardcodedProperties()
    {
        return new List<PostModel>
    {
        new PostModel
        {
            Title = "Cozy Cottage",
            Address = "123 Pine Street",
            Price = 250000,
            RoomCount = "3",
            MainImageUrl = "https://images.unsplash.com/photo-1592595896551-12b371d546d5?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
        new PostModel
        {
            Title = "Modern Apartment",
            Address = "789 Elm Avenue",
            Price = 400000,
            RoomCount = "2",
            MainImageUrl = "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
        new PostModel
        {
            Title = "Spacious Villa",
            Address = "456 Oak Lane",
            Price = 700,
            RoomCount = "5",
            MainImageUrl = "https://images.unsplash.com/photo-1448630360428-65456885c650?q=80&w=2067&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
         new PostModel
        {
            Title = "Bla1",
            Address = "123 Pine Street",
            Price = 250000,
            RoomCount = "3",
            MainImageUrl = "https://images.unsplash.com/photo-1580587771525-78b9dba3b914?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
		new PostModel
        {
            Title = "Bla2",
            Address = "123 Pine Street",
            Price = 250000,
            RoomCount = "3",
            MainImageUrl = "https://images.unsplash.com/photo-1558036117-15d82a90b9b1?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
        new PostModel
        {
            Title = "Bla3",
            Address = "789 Elm Avenue",
            Price = 400000,
            RoomCount = "2",
            MainImageUrl = "https://images.unsplash.com/photo-1494526585095-c41746248156?w=600&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MzB8fHJlYWwlMjBlc3RhdGV8ZW58MHx8MHx8fDA%3D"
        },
        new PostModel
        {
            Title = "Bla4",
            Address = "456 Oak Lane",
            Price = 700,
            RoomCount = "5",
            MainImageUrl = "https://images.unsplash.com/photo-1628624747186-a941c476b7ef?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
         new PostModel
        {
            Title = "aaaaaaaaa",
            Address = "123 Pine Street",
            Price = 250000,
            RoomCount = "3",
            MainImageUrl = "https://images.unsplash.com/photo-1460317442991-0ec209397118?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
        new PostModel
        {
            Title = "bbbbbbbbb",
            Address = "123 Pine Street",
            Price = 250000,
            RoomCount = "3",
            MainImageUrl = "https://images.unsplash.com/photo-1605146769289-440113cc3d00?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
        new PostModel
        {
            Title = "ccccccccc",
            Address = "789 Elm Avenue",
            Price = 400000,
            RoomCount = "2",
            MainImageUrl = "https://images.unsplash.com/photo-1605276374104-dee2a0ed3cd6?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
        new PostModel
        {
            Title = "dddddddd",
            Address = "456 Oak Lane",
            Price = 700,
            RoomCount = "5",
            MainImageUrl = "https://images.unsplash.com/photo-1523217582562-09d0def993a6?q=80&w=1780&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
         new PostModel
        {
            Title = "eeeeeeeeeeee",
            Address = "123 Pine Street",
            Price = 250000,
            RoomCount = "3",
            MainImageUrl = "https://images.unsplash.com/photo-1628133287836-40bd5453bed1?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
        },
        
    };
    }


    private int propertyIndex = 0;
	private UserInfo user;
	private AuthenticationState authenticationState;
	public bool isAuth { get; set; }
	private string mapString = "https://www.google.com/maps/embed/v1/place?key=AIzaSyAAaZMqlkwagX5OT8cvyoEEu14VJx--Kjk&q=Space+Needle,Seattle+WA";

	public async Task GetSessionUser()
	{
		user = await session.GetItemAsync<UserInfo>("SessionUser");
	}

	public async Task Logout()
	{
		session.ClearAsync();
		await authStateProvider.Logout();
		user = new UserInfo();
		navigationManager.NavigateTo("/login", forceLoad: true);
	}

	protected override async Task OnParametersSetAsync()
	{
		await GetSessionUser();
		Console.WriteLine("started");
		authenticationState = await authStateProvider.GetAuthenticationStateAsync();

		if (authenticationState.User.Identity.IsAuthenticated)
		{
			Console.WriteLine("authState : "+authenticationState.User.Identity.Name);
			isAuth = true;
		} else 
		{
			Console.WriteLine("not authenticated");
			isAuth = false;
		}
	}
}              