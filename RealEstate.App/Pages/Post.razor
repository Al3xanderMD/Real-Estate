@page "/{PropertyType}/post/{PostId}"
@using RealEstate.App.Models
@using RealEstate.App.Operations.Fetch.Models
@using RealEstate.App.Operations.Fetch.Response

@inject NavigationManager navigationManager
@inject FetchService fetchService

@if (!propertyTypes.Contains(PropertyType)) {
    navigationManager.NavigateTo("/notFound");
}

@if (ready)
{
	<MudContainer Style="text-align:center;">
		<MudText Typo="Typo.h1">@pageModel.title</MudText>
	</MudContainer>
}

@code {
	[Parameter]
	public string PostId { get; set; }
	[Parameter]
	public string PropertyType { get; set; }

	private string[] propertyTypes = new string[] { "apartment", "house", "commercial", "hotel", "lot" }; // todo: make dynamic
	private bool ready = false;
	private ApartmentFetchViewModel apartment;
	private HouseFetchViewModel house;
	private CommercialFetchViewModel commercial;
	private HotelPensionFetchViewModel hotel;
	private LotFetchViewModel lot;
	private PageBaseModel pageModel = new PageBaseModel();

	protected override async Task OnParametersSetAsync()
	{
		PostResponseViewModel postData = await fetchService.FetchPostAsync(Int16.Parse(PostId));
		Console.WriteLine("post data fetched "+postData.basePostId);
		switch (PropertyType) {
			case "apartment":
				if (postData.type == "apartment")
				{
					Console.WriteLine("apartment type");
					apartment = await fetchService.FetchApartmentAsync(postData.basePostId);

					if (apartment != null)
					{
						Console.WriteLine("apartment found");
						pageModel.title = apartment.titlePost;
						pageModel.description = apartment.description;
						ready = true;
					}
					else
					{
						Console.WriteLine("apartment not found");
					}
				}
				else
				{
					Console.WriteLine("mismatched property type");
					navigationManager.NavigateTo("/notFound");
				}
				break;
			case "house":
				if (postData.type == "house")
				{
					Console.WriteLine("house type");
					house = await fetchService.FetchHouseAsync(postData.basePostId);

					if (house != null)
					{
						Console.WriteLine("house found");
						pageModel.title = house.titlePost;
						pageModel.description = house.description;
						ready = true;
					}
					else
					{
						Console.WriteLine("house not found");

					}
				}
				else
				{
					Console.WriteLine("mismatched property type");
					navigationManager.NavigateTo("/notFound");
				}
				Console.WriteLine("house type");
				break;
			case "commercial":
				Console.WriteLine("commercial type");
				if (postData.type == "commercial")
				{
					Console.WriteLine("commercial type");

					commercial = await fetchService.FetchCommercialAsync(postData.basePostId);

					if (commercial != null)
					{
						Console.WriteLine("commercial found");
						pageModel.title = commercial.titlePost;
						pageModel.description = commercial.description;
						ready = true;
					}
					else
					{
						Console.WriteLine("commercial not found");
					}
				}
				else
				{
					Console.WriteLine("mismatched property type");
					navigationManager.NavigateTo("/notFound");
				}
				break;
			case "hotel":
				Console.WriteLine("hotel type");
				if (postData.type == "hotel")
				{
					Console.WriteLine("hotel type");

					hotel = await fetchService.FetchHotelPensionAsync(postData.basePostId);

					if (hotel != null)
					{
						Console.WriteLine("hotel found");
						pageModel.title = hotel.titlePost;
						pageModel.description = hotel.description;
						ready = true;
					}
					else
					{
						Console.WriteLine("hotel not found");
					}
				}
				else
				{
					Console.WriteLine("mismatched property type");
					navigationManager.NavigateTo("/notFound");
				}
				break;
			case "lot":
				Console.WriteLine("lot type");
				if (postData.type == "lot")
				{
					Console.WriteLine("lot type");

					lot = await fetchService.FetchLotAsync(postData.basePostId);

					if (lot != null)
					{
						Console.WriteLine("lot found");
						pageModel.title = lot.titlePost;
						pageModel.description = lot.description;
						ready = true;
					}
					else
					{
						Console.WriteLine("lot not found");
					}
				}
				else
				{
					Console.WriteLine("mismatched property type");
					navigationManager.NavigateTo("/notFound");
				}
				break;
			default:
				Console.WriteLine("invalid property type");
				break;
		}
    }
}
